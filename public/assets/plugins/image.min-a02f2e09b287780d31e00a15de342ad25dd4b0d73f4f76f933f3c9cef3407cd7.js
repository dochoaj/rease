/*!
 * froala_editor v2.0.1 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";e.extend(e.FroalaEditor.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),e.extend(e.FroalaEditor.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUploadURL:"http://i.froala.com/upload",imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","svg+xml"],imageResize:!0,imageResizeWithPercent:!1,imageMove:!0,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered"},imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0}),e.FroalaEditor.PLUGINS.image=function(t){function n(){var e=t.popups.get("image.insert"),n=e.find(".fr-image-by-url-layer input");n.val(""),se&&n.val(se.attr("src")),n.trigger("change")}function i(){var e=t.$tb.find('.fr-command[data-cmd="insertImage"]'),n=t.popups.get("image.insert");if(n||(n=D()),v(),!n.hasClass("fr-active"))if(t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$tb),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,a=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("image.insert",i,a,e.outerHeight())}else t.position.forSelection(n),t.popups.show("image.insert")}function a(){var n=t.popups.get("image.edit");n||(n=h()),t.popups.setContainer("image.edit",e(t.opts.scrollableContainer)),t.popups.refresh("image.edit");var i=se.offset().left+se.outerWidth()/2,a=se.offset().top+se.outerHeight();t.popups.show("image.edit",i,a,se.outerHeight())}function o(){v()}function r(e){if(!e.hasClass("fr-dii")&&!e.hasClass("fr-dib")){var n=e.css("float");e.css("float","none"),"block"==e.css("display")?(e.css("float",n),0===parseInt(e.css("margin-left"),10)&&(e.attr("style")||"").indexOf("margin-right: auto")>=0?e.addClass("fr-fil"):0===parseInt(e.css("margin-right"),10)&&(e.attr("style")||"").indexOf("margin-left: auto")>=0&&e.addClass("fr-fir"),e.addClass("fr-dib")):(e.css("float",n),"left"==e.css("float")?e.addClass("fr-fil"):"right"==e.css("float")&&e.addClass("fr-fir"),e.addClass("fr-dii")),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align","")}e.attr("width")&&(e.css("width",e.width()),e.removeAttr("width")),t.opts.imageTextNear||e.removeClass("fr-dii").addClass("fr-dib")}function s(){for(var n="IMG"==t.$el.get(0).tagName?[t.$el.get(0)]:t.$el.get(0).querySelectorAll("img"),i=0;i<n.length;i++)r(e(n[i])),t.opts.iframe&&e(n[i]).on("load",t.size.syncIframe)}function l(){var n,i=Array.prototype.slice.call(t.$el.get(0).querySelectorAll("img")),a=[];for(n=0;n<i.length;n++)a.push(i[n].getAttribute("src"));if(we)for(n=0;n<we.length;n++)a.indexOf(we[n].getAttribute("src"))<0&&t.events.trigger("image.removed",[e(we[n])]);we=i}function c(){le||H();var e=t.$wp?t.$wp.scrollTop()-(t.$wp.offset().top+1):-1,n=t.$wp?t.$wp.scrollLeft()-(t.$wp.offset().left+1):-1;t.$wp&&(n-=t.helpers.getPX(t.$wp.css("border-left-width"))),le.css("top",t.opts.iframe?se.offset().top-1:se.offset().top+e).css("left",t.opts.iframe?se.offset().left-1:se.offset().left+n).css("width",se.outerWidth()).css("height",se.outerHeight()).addClass("fr-active")}function d(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function u(n){n.preventDefault(),n.stopPropagation(),ce=e(this),ce.data("start-x",n.pageX||n.originalEvent.touches[0].pageX),de.show(),t.popups.hideAll()}function f(n){if(ce){n.preventDefault();var i=n.pageX||(n.originalEvent.touches?n.originalEvent.touches[0].pageX:null);if(!i)return!1;var a=ce.data("start-x");ce.data("start-x",i);var o=i-a,r=se.width();if((ce.hasClass("fr-hnw")||ce.hasClass("fr-hsw"))&&(o=0-o),t.opts.imageResizeWithPercent){var s=se.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0);se.css("width",((r+o)/e(s).outerWidth()*100).toFixed(2)+"%")}else se.css("width",r+o);se.css("height","").removeAttr("height"),c(),t.events.trigger("image.resize",[oe()])}}function p(e){ce&&(e&&e.stopPropagation(),ce=null,de.hide(),c(),a(),t.undo.saveStep(),t.events.trigger("image.resizeEnd",[oe()]))}function g(e,n){t.edit.on(),w(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("image.error",[{code:e,message:ye[e]},n])}function h(){var e="";t.opts.imageEditButtons.length>1&&(e+='<div class="fr-buttons">',e+=t.button.buildList(t.opts.imageEditButtons),e+="</div>");var n={buttons:e},i=t.popups.create("image.edit",n);return t.$wp&&(t.$wp.on("scroll.image-edit",function(){se&&t.popups.isVisible("image.edit")&&a()}),t.events.on("destroy",function(){t.$wp.off("scroll.image-edit")})),i}function m(){var e=t.popups.get("image.insert");e&&(e.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),e.find(".fr-image-progress-bar-layer").addClass("fr-active"),e.find(".fr-buttons").hide(),y("Uploading",0))}function v(e){var n=t.popups.get("image.insert");n&&(n.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),n.find(".fr-image-progress-bar-layer").removeClass("fr-active"),n.find(".fr-buttons").show(),e&&t.popups.show("image.insert",null,null))}function y(e,n){var i=t.popups.get("image.insert");if(i){var a=i.find(".fr-image-progress-bar-layer");a.find("h3").text(e+(n?" "+n+"%":"")),a.removeClass("fr-error"),n?(a.find("div").removeClass("fr-indeterminate"),a.find("div > span").css("width",n+"%")):a.find("div").addClass("fr-indeterminate")}}function w(e){var n=t.popups.get("image.insert"),i=n.find(".fr-image-progress-bar-layer");i.addClass("fr-error"),i.find("h3").text(e)}function b(){var e=t.popups.get("image.insert"),n=e.find(".fr-image-by-url-layer input");n.val().length>0&&(m(),y("Loading image"),k(t.helpers.sanitizeURL(n.val()),!0,[],se),n.val(""),n.blur())}function k(n,i,a,o,r){t.edit.off(),y("Loading image");var s=new Image;s.onload=function(){var i,s;if(o){i=o.clone(),o.replaceWith(i),i.off("load");for(var l=i.get(0).attributes,c=0;c<l.length;c++){var d=l[c];0===d.nodeName.indexOf("data-")&&i.removeAttr(d.nodeName)}if("undefined"!=typeof a)for(s in a)"link"!=s&&i.attr("data-"+s,a[s]);i.on("load",function(){t.popups.hide("image.insert"),i.trigger("click").trigger("touchend"),t.events.trigger("image.loaded",[i])}),i.attr("src",n),t.edit.on(),t.undo.saveStep(),t.events.trigger("image.replaced",[i,r])}else{var u="";if("undefined"!=typeof a)for(s in a)"link"!=s&&(u+=" data-"+s+'="'+a[s]+'"');var f=t.opts.imageDefaultWidth;f&&"auto"!=f&&(""+f).indexOf("px")<0&&(""+f).indexOf("%")<0&&(f+="px"),i=e('<img class="fr-di'+t.opts.imageDefaultDisplay[0]+("center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+n+'"'+u+(f?' style="width: '+f+';"':"")+">"),i.on("load",function(){i.trigger("click").trigger("touchend"),t.events.trigger("image.loaded",[i])}),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.selection.isCollapsed()||t.selection.remove(),t.markers.insert();var p=t.$el.find(".fr-marker");p.replaceWith(i),t.selection.clear(),t.undo.saveStep(),t.events.trigger("image.inserted",[i,r])}},s.onerror=function(){g(ue)},s.src=n}function S(n){try{if(t.events.trigger("image.uploaded",[n],!0)===!1)return t.edit.on(),!1;var i=e.parseJSON(n);return i.link?i:(g(fe,n),!1)}catch(a){return g(ge,n),!1}}function C(n){try{var i=e(n).find("Location").text(),a=e(n).find("Key").text();return t.events.trigger("image.uploadedToS3",[i,a,n],!0)===!1?(t.edit.on(),!1):i}catch(o){return g(ge,n),!1}}function E(e){y("Loading image");var n=this.status,i=this.response,a=this.responseXML,o=this.responseText;try{if(t.opts.imageUploadToS3)if(201==n){var r=C(a);r&&k(r,!1,[],e,i||a)}else g(ge,i||a);else if(n>=200&&300>n){var s=S(o);s&&k(s.link,!1,s,e,i||o)}else g(pe,i||o)}catch(l){g(ge,i||o)}}function T(){g(ge,this.response||this.responseText||this.responseXML)}function _(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;y("Uploading",t)}}function A(e){if(t.events.trigger("image.beforeUpload",[e])===!1)return!1;if("undefined"!=typeof e&&e.length>0){var n=e[0];if(n.size>t.opts.imageMaxSize)return g(he),!1;if(t.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))<0)return g(me),!1;var i;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var a;if(t.opts.imageUploadToS3!==!1){i.append("key",t.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",n.type);for(a in t.opts.imageUploadToS3.params)i.append(a,t.opts.imageUploadToS3.params[a])}for(a in t.opts.imageUploadParams)i.append(a,t.opts.imageUploadParams[a]);i.append(t.opts.imageUploadParam,n);var o=t.opts.imageUploadURL;t.opts.imageUploadToS3&&(o="https://"+t.opts.imageUploadToS3.region+".amazonaws.com/"+t.opts.imageUploadToS3.bucket);var r=t.core.getXHR(o,t.opts.imageUploadMethod),s=se;r.onload=function(){E.call(r,s)},r.onerror=T,r.upload.onprogress=_,m(),t.edit.off(),r.send(i)}}}function F(t){t.on("dragover dragenter",".fr-image-upload-layer",function(){return e(this).addClass("fr-drop"),!1}),t.on("dragleave dragend",".fr-image-upload-layer",function(){return e(this).removeClass("fr-drop"),!1}),t.on("drop",".fr-image-upload-layer",function(t){t.preventDefault(),t.stopPropagation(),e(this).removeClass("fr-drop");var n=t.originalEvent.dataTransfer;n&&n.files&&A(n.files)}),t.on("change",'.fr-image-upload-layer input[type="file"]',function(){this.files&&A(this.files),e(this).val(""),e(this).blur()})}function x(){t.$el.on(t._mousedown,"IMG"==t.$el.get(0).tagName?null:"img",function(n){t.selection.clear(),t.browser.msie&&(t.events.disableBlur(),t.$el.attr("contenteditable",!1)),t.opts.imageMove||n.preventDefault(),n.stopPropagation(),t.opts.imageMove&&(t.opts.toolbarInline&&t.toolbar.hide(),e(this).addClass("fr-img-move"))}),t.$el.on(t._mouseup,"IMG"==t.$el.get(0).tagName?null:"img",function(n){n.stopPropagation(),t.browser.msie&&(t.$el.attr("contenteditable",!0),t.events.enableBlur()),e(this).removeClass("fr-img-move")});var n=function(e){var n=t.$document.find("img.fr-img-move").get(0);return n?"undefined"!=typeof t.browser.msie||"undefined"!=typeof t.browser.edge:void e.preventDefault()},i=function(e){e.preventDefault()};t.events.on("dragenter",i,!0),t.events.on("dragover",n,!0),t.events.on("drop",function(n){for(var i,a,o=0;o<e.FroalaEditor.INSTANCES.length;o++)if(i=e.FroalaEditor.INSTANCES[o].$el.find("img.fr-img-move").get(0)){a=e.FroalaEditor.INSTANCES[o];break}if(i){n.preventDefault(),n.stopPropagation(),Y(!0),a!=t&&a.image&&(a.image.exitEdit(!0),a.popups.hide("image.edit"));var r,s;"A"==i.parentNode.tagName&&0===i.parentNode.textContent.length?(s=e(i.parentNode),r=e(i.parentNode).clone(),r.find("img").removeClass("fr-img-move").on("load",q)):(s=e(i),r=e(i).clone(),r.removeClass("fr-img-move").on("load",q)),t.markers.insertAtPoint(n.originalEvent);var l=t.$el.find(".fr-marker");return l.replaceWith(r),s.remove(),t.undo.saveStep(),!1}Y(!0),t.popups.hideAll();var c=n.originalEvent.dataTransfer;if(c&&c.files&&c.files.length&&(i=c.files[0],i&&i.type&&t.opts.imageAllowedTypes.indexOf(i.type.replace(/image\//g,""))>=0)){t.markers.insertAtPoint(n.originalEvent),t.markers.remove(),t.popups.hideAll();var d=t.popups.get("image.insert");return d||(d=D()),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)),t.popups.show("image.insert",n.originalEvent.pageX,n.originalEvent.pageY),m(),A(c.files),n.preventDefault(),n.stopPropagation(),!1}},!0),t.events.on("document.drop",function(e){t.$el.find("img.fr-img-move").length&&(e.preventDefault(),e.stopPropagation(),t.$el.find("img.fr-img-move").removeClass("fr-img-move"))}),t.events.on("mousedown",Z),t.events.on("window.mousedown",Z),t.events.on("window.touchmove",X),t.events.on("mouseup",Y),t.events.on("window.mouseup",Y),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&Y()}),t.events.on("image.hideResizer",function(){Y(!0)}),t.events.on("commands.undo",function(){Y(!0)}),t.events.on("commands.redo",function(){Y(!0)}),t.events.on("destroy",function(){t.$el.off(t._mouseup,"img")},!0)}function D(){var e,i="";t.opts.imageInsertButtons.length>1&&(i='<div class="fr-buttons">'+t.button.buildList(t.opts.imageInsertButtons)+"</div>");var a=t.opts.imageInsertButtons.indexOf("imageUpload"),r=t.opts.imageInsertButtons.indexOf("imageByURL"),s="";a>=0&&(e=" fr-active",r>=0&&a>r&&(e=""),s='<div class="fr-image-upload-layer'+e+' fr-layer" id="fr-image-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop image")+"</strong><br>("+t.language.translate("or click")+')<form><input type="file" name="'+t.opts.imageUploadParam+'" accept="image/*" tabIndex="-1"></form></div>');var l="";r>=0&&(e=" fr-active",a>=0&&r>a&&(e=""),l='<div class="fr-image-by-url-layer'+e+' fr-layer" id="fr-image-by-url-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2">'+t.language.translate("Insert")+"</button></div></div>");var c='<div class="fr-image-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-back" data-cmd="imageDismissError" tabIndex="2">OK</button></div></div>',d={buttons:i,upload_layer:s,by_url_layer:l,progress_bar:c},u=t.popups.create("image.insert",d);return t.popups.onRefresh("image.insert",n),t.popups.onHide("image.insert",o),t.$wp&&t.$wp.on("scroll.image-insert",function(){se&&t.popups.isVisible("image.insert")&&ie()}),t.events.on("destroy",function(){t.$wp&&t.$wp.off("scroll.image-insert"),u.off("dragover dragenter",".fr-image-upload-layer"),u.off("dragleave dragend",".fr-image-upload-layer"),u.off("drop",".fr-image-upload-layer"),u.off("change",'.fr-image-upload-layer input[type="file"]')}),F(u),u}function I(){if(se){var e=t.popups.get("image.alt");e.find("input").val(se.attr("alt")||"").trigger("change")}}function z(){var n=t.popups.get("image.alt");n||(n=L()),v(),t.popups.refresh("image.alt"),t.popups.setContainer("image.alt",e(t.opts.scrollableContainer));var i=se.offset().left+se.width()/2,a=se.offset().top+se.height();t.popups.show("image.alt",i,a,se.outerHeight())}function L(){var e="";e='<div class="fr-buttons">'+t.button.buildList(t.opts.imageAltButtons)+"</div>";var n="";n='<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="'+t.language.translate("Alternate Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var i={buttons:e,alt_layer:n},a=t.popups.create("image.alt",i);return t.popups.onRefresh("image.alt",I),t.$wp&&(t.$wp.on("scroll.image-alt",function(){se&&t.popups.isVisible("image.alt")&&z()}),t.events.on("destroy",function(){t.$wp.off("scroll.image-alt")})),a}function R(e){if(se){var n=t.popups.get("image.alt");se.attr("alt",e||n.find("input").val()||""),n.find("input").blur(),setTimeout(function(){se.trigger("click").trigger("touchend")},t.helpers.isAndroid()?50:0)}}function j(){if(se){var e=t.popups.get("image.size");e.find('input[name="width"]').val(se.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(se.get(0).style.height).trigger("change")}}function N(){var n=t.popups.get("image.size");n||(n=M()),v(),t.popups.refresh("image.size"),t.popups.setContainer("image.size",e(t.opts.scrollableContainer));var i=se.offset().left+se.width()/2,a=se.offset().top+se.height();t.popups.show("image.size",i,a,se.outerHeight())}function M(){var e="";e='<div class="fr-buttons">'+t.button.buildList(t.opts.imageSizeButtons)+"</div>";var n="";n='<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+t.id+'"><div class="fr-image-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var i={buttons:e,size_layer:n},a=t.popups.create("image.size",i);return t.popups.onRefresh("image.size",j),t.$wp&&(t.$wp.on("scroll.image-size",function(){se&&t.popups.isVisible("image.size")&&N()}),t.events.on("destroy",function(){t.$wp.off("scroll.image-size")})),a}function O(e,n){if(se){var i=t.popups.get("image.size");se.css("width",e||i.find('input[name="width"]').val()),se.css("height",n||i.find('input[name="height"]').val()),i.find("input").blur(),setTimeout(function(){se.trigger("click").trigger("touchend")},t.helpers.isAndroid()?50:0)}}function B(e){var n,i,a=t.popups.get("image.insert");if(se||t.opts.toolbarInline)se&&(i=se.offset().top+se.outerHeight());else{var o=t.$tb.find('.fr-command[data-cmd="insertImage"]');n=o.offset().left+o.outerWidth()/2,i=o.offset().top+(t.opts.toolbarBottom?10:o.outerHeight()-10)}!se&&t.opts.toolbarInline&&(i=a.offset().top-t.helpers.getPX(a.css("margin-top")),a.hasClass("fr-above")&&(i+=a.outerHeight())),a.find(".fr-layer").removeClass("fr-active"),a.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("image.insert",n,i,se?se.outerHeight():0)}function U(e){var n=t.popups.get("image.insert");n.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active")}function P(e){var n=t.popups.get("image.insert");n.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active")}function H(){if(le=e('<div class="fr-image-resizer"></div>'),(t.$wp||e(t.opts.scrollableContainer)).append(le),le.on("mousedown",function(e){e.stopPropagation()}),e(t.original_window).on("resize.image"+t.id,function(){t.helpers.isMobile()||Y(!0)}),t.events.on("destroy",function(){le.html("").removeData().remove(),e(t.original_window).off("resize.image"+t.id)},!0),t.opts.imageResize){le.append(d("nw")+d("ne")+d("sw")+d("se"));var n=le.get(0).ownerDocument;le.on(t._mousedown+".imgresize"+t.id,".fr-handler",u),e(n).on(t._mousemove+".imgresize"+t.id,f),e(n.defaultView||n.parentWindow).on(t._mouseup+".imgresize"+t.id,p),de=e('<div class="fr-image-overlay"></div>'),e(n).find("body").append(de),de.on("mouseleave",p),t.events.on("destroy",function(){le.off(t._mousedown+".imgresize"+t.id),e(n).off(t._mousemove+".imgresize"+t.id),e(n.defaultView||n.parentWindow).off(t._mouseup+".imgresize"+t.id),de.off("mouseleave").remove()},!0)}}function $(n){n=n||se,n&&t.events.trigger("image.beforeRemove",[n])!==!1&&(t.popups.hideAll(),Y(!0),n.get(0)==t.$el.get(0)?n.removeAttr("src"):("A"==n.get(0).parentNode.tagName?(t.selection.setBefore(n.get(0).parentNode)||t.selection.setAfter(n.get(0).parentNode),e(n.get(0).parentNode).remove()):(t.selection.setBefore(n.get(0))||t.selection.setAfter(n.get(0)),n.remove()),t.selection.restore(),t.html.fillEmptyBlocks(!0)),t.undo.saveStep())}function K(){x(),t.$el.on(t.helpers.isMobile()?"touchend":"click","IMG"==t.$el.get(0).tagName?null:"img",q),t.helpers.isMobile()&&(t.$el.on("touchstart","IMG"==t.$el.get(0).tagName?null:"img",function(){be=!1}),t.$el.on("touchmove",function(){be=!0})),t.events.on("keydown",function(n){var i=n.which;return!se||i!=e.FroalaEditor.KEYCODE.BACKSPACE&&i!=e.FroalaEditor.KEYCODE.DELETE?se&&i==e.FroalaEditor.KEYCODE.ESC?(Y(!0),n.preventDefault(),!1):se&&!t.keys.ctrlKey(n)?(n.preventDefault(),!1):void 0:(n.preventDefault(),$(),!1)},!0),t.events.on("paste.before",V),t.events.on("paste.beforeCleanup",G),t.events.on("paste.after",W),t.events.on("html.set",s),s(),t.opts.iframe&&t.events.on("image.loaded",t.size.syncIframe),t.$wp&&(l(),t.events.on("contentChanged",l)),e(t.original_window).on("orientationchange.image."+t.id,function(){setTimeout(function(){var e=oe();e&&e.trigger("click").trigger("touchend")},0)}),t.events.on("destroy",function(){t.$el.off("click touchstart touchend touchmove","img"),t.$el.off("load","img.fr-img-dirty"),t.$el.off("error","img.fr-img-dirty"),e(t.original_window).off("orientationchange.image."+t.id)},!0),t.events.on("node.remove",function(e){return"IMG"==e.get(0).tagName?($(e),!1):void 0})}function W(){t.opts.imagePaste?t.$el.find("img[data-fr-image-pasted]").each(function(n,i){if(0===i.src.indexOf("data:")){if(t.events.trigger("image.beforePasteUpload",[i])===!1)return!1;var o=t.opts.imageDefaultWidth;"auto"!=o&&(o+=t.opts.imageResizeWithPercent?"%":"px"),e(i).css("width",o),e(i).addClass("fr-dib"),se=e(i),c(),a(),ie(),m(),t.edit.off();for(var r=atob(e(i).attr("src").split(",")[1]),s=[],l=0;l<r.length;l++)s.push(r.charCodeAt(l));var d=new Blob([new Uint8Array(s)],{type:"image/jpeg"});A([d]),e(i).removeAttr("data-fr-image-pasted")}else 0!==i.src.indexOf("http")?(t.selection.save(),e(i).remove(),t.selection.restore()):e(i).removeAttr("data-fr-image-pasted")}):t.$el.find("img[data-fr-image-pasted]").remove()}function V(e){if(e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items[0]){var n=e.clipboardData.items[0].getAsFile();if(n){var i=new FileReader;return i.onload=function(e){var n=e.target.result;t.html.insert('<img data-fr-image-pasted="true" src="'+n+'" />'),t.events.trigger("paste.after")},i.readAsDataURL(n),!1}}}function G(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function q(n){if(n&&"touchend"==n.type&&be)return!0;if(t.edit.isDisabled())return n.stopPropagation(),n.preventDefault(),!1;t.toolbar.disable(),n.stopPropagation(),n.preventDefault(),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.opts.iframe&&t.size.syncIframe(),se=e(this),c(),a(),t.selection.clear(),t.button.bulkRefresh(),t.events.trigger("video.hideResizer");for(var i=0;i<e.FroalaEditor.INSTANCES.length;i++)e.FroalaEditor.INSTANCES[i]!=t&&e.FroalaEditor.INSTANCES[i].events.trigger("image.hideResizer")}function Y(e){e===!0&&(ke=!0),se&&ke&&(t.toolbar.enable(),le.removeClass("fr-active"),t.popups.hide("image.edit"),se=null),ke=!1}function Z(){ke=!0}function X(){ke=!1}function Q(e){se.removeClass("fr-fir fr-fil"),"left"==e?se.addClass("fr-fil"):"right"==e&&se.addClass("fr-fir"),c(),a()}function J(e){se&&(se.hasClass("fr-fil")?e.find("> i").attr("class","fa fa-align-left"):se.hasClass("fr-fir")?e.find("> i").attr("class","fa fa-align-right"):e.find("> i").attr("class","fa fa-align-justify"))}function ee(e,t){if(se){var n="justify";se.hasClass("fr-fil")?n="left":se.hasClass("fr-fir")&&(n="right"),t.find('.fr-command[data-param1="'+n+'"]').addClass("fr-active")}}function te(e){se.removeClass("fr-dii fr-dib"),"inline"==e?se.addClass("fr-dii"):"block"==e&&se.addClass("fr-dib"),c(),a()}function ne(e,t){var n="block";se.hasClass("fr-dii")&&(n="inline"),t.find('.fr-command[data-param1="'+n+'"]').addClass("fr-active")}function ie(){var n=t.popups.get("image.insert");n||(n=D()),t.popups.isVisible("image.insert")||(v(),t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)));var i=se.offset().left+se.width()/2,a=se.offset().top+se.height();t.popups.show("image.insert",i,a,se.outerHeight())}function ae(){se?se.trigger("click").trigger("touchend"):(t.popups.hide("image.insert"),t.toolbar.showInline())}function oe(){return se}function re(e){if(!se)return!1;if(!t.opts.imageMultipleStyles){var n=Object.keys(t.opts.imageStyles);n.splice(n.indexOf(e),1),se.removeClass(n.join(" "))}se.toggleClass(e),se.trigger("click").trigger("touchend")}var se,le,ce,de,ue=1,fe=2,pe=3,ge=4,he=5,me=6,ve=7,ye={};ye[ue]="Image cannot be loaded from the passed link.",ye[fe]="No link in upload response.",ye[pe]="Error during file upload.",ye[ge]="Parsing response failed.",ye[he]="File is too large.",ye[me]="Image file type is invalid.",ye[ve]="Files can be uploaded only to same domain in IE 8 and IE 9.";var we,be,ke=!1;return{_init:K,showInsertPopup:i,showLayer:B,refreshUploadButton:U,refreshByURLButton:P,upload:A,insertByURL:b,align:Q,refreshAlign:J,refreshAlignOnShow:ee,display:te,refreshDisplayOnShow:ne,replace:ie,back:ae,get:oe,insert:k,showProgressBar:m,remove:$,hideProgressBar:v,applyStyle:re,showAltPopup:z,showSizePopup:N,setAlt:R,setSize:O,exitEdit:Y}},e.FroalaEditor.DefineIcon("insertImage",{NAME:"image"}),e.FroalaEditor.RegisterShortcut(80,"insertImage"),e.FroalaEditor.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refershAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()}}),e.FroalaEditor.DefineIcon("imageUpload",{NAME:"upload"}),e.FroalaEditor.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.FroalaEditor.DefineIcon("imageByURL",{NAME:"link"}),e.FroalaEditor.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.FroalaEditor.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){var t=this.image.get();t?e.text("Replace"):e.text(this.language.translate("Insert"))}}),e.FroalaEditor.DefineIcon("imageDisplay",{NAME:"star"}),e.FroalaEditor.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.FroalaEditor.DefineIcon("imageAlign",{NAME:"align-center"}),e.FroalaEditor.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list">',n=e.FroalaEditor.COMMANDS.imageAlign.options;for(var i in n)t+='<li><a class="fr-command fr-title" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(n[i])+'"><i class="fa fa-align-'+i+'"></i></a></li>';return t+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.FroalaEditor.DefineIcon("imageReplace",{NAME:"exchange"}),e.FroalaEditor.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.FroalaEditor.DefineIcon("imageRemove",{NAME:"trash"}),e.FroalaEditor.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.FroalaEditor.DefineIcon("imageBack",{NAME:"arrow-left"}),e.FroalaEditor.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){var t=this.image.get();t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FroalaEditor.RegisterCommand("imageDismissError",{title:"OK",callback:function(){this.image.hideProgressBar(!0)}}),e.FroalaEditor.DefineIcon("imageStyle",{NAME:"magic"}),e.FroalaEditor.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list">',t=this.opts.imageStyles;for(var n in t)e+='<li><a class="fr-command" data-cmd="imageStyle" data-param1="'+n+'">'+this.language.translate(t[n])+"</a></li>";return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(t,n){var i=this.image.get();i&&n.find(".fr-command").each(function(){var t=e(this).data("param1");e(this).toggleClass("fr-active",i.hasClass(t))})}}),e.FroalaEditor.DefineIcon("imageAlt",{NAME:"info"}),e.FroalaEditor.RegisterCommand("imageAlt",{undo:!1,focus:!1,title:"Alternate Text",callback:function(){this.image.showAltPopup()}}),e.FroalaEditor.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.FroalaEditor.DefineIcon("imageSize",{NAME:"arrows-alt"}),e.FroalaEditor.RegisterCommand("imageSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.FroalaEditor.RegisterCommand("imageSetSize",{undo:!0,focus:!1,callback:function(){this.image.setSize()}})});