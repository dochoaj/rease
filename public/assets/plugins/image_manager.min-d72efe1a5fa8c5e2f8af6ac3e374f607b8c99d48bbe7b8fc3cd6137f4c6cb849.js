/*!
 * froala_editor v2.0.1 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){"function"==typeof define&&define.amd?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";if(e.extend(e.FroalaEditor.DEFAULTS,{imageManagerLoadURL:"http://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:"",imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),e.FroalaEditor.PLUGINS.imageManager=function(t){function n(){T.show(),I.show(),V=t.image.get(),_||C(),l(),t.$document.find("body").addClass("prevent-scroll"),t.helpers.isMobile()&&t.$document.find("body").addClass("fr-mobile")}function i(){t.events.enableBlur(),T.hide(),I.hide(),t.$document.find("body").removeClass("prevent-scroll fr-mobile")}function a(){var t=e(window).outerWidth();return 768>t?2:1200>t?3:4}function o(){A.empty();for(var e=0;N>e;e++)A.append('<div class="fr-list-column"></div>')}function r(){var n="";t.opts.theme&&(n=" "+t.opts.theme+"-theme");var i='<div class="fr-modal'+n+'"><div class="fr-modal-wrapper">';return i+='<div class="fr-modal-title"><div class="fr-modal-title-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+t.id+'" title="'+t.language.translate("Tags")+'"></i><h4 data-text="true">'+t.language.translate("Manage Images")+'</h4><i title="'+t.language.translate("Cancel")+'" class="fa fa-times fr-modal-close" id="fr-modal-close-'+t.id+'"></i></div>',i+='<div class="fr-modal-tags" id="fr-modal-tags-'+t.id+'"></div>',i+="</div>",i+='<img class="fr-preloader" id="fr-preloader-'+t.id+'" alt="'+t.language.translate("Loading")+'.." src="'+t.opts.imageManagerPreloader+'" style="display: none;">',i+='<div class="fr-scroller" id="fr-scroller-'+t.id+'"><div class="fr-image-list" id="fr-image-list-'+t.id+'"></div></div>',i+="</div></div>",e(i)}function s(){T=r(),t.helpers.isMobile()||T.addClass("fr-desktop"),T.appendTo("body"),I=e('<div class="fr-overlay">').appendTo("body"),t.opts.theme&&I.addClass(t.opts.theme+"-theme"),i(),t.events.on("destroy",function(){T.removeData().remove(),I.removeData().remove()},!0)}function l(){_.show(),A.find(".fr-list-column").empty(),t.opts.imageManagerLoadURL?e.ajax({url:t.opts.imageManagerLoadURL,method:t.opts.imageManagerLoadMethod,data:t.opts.imageManagerLoadParams,dataType:"json"}).done(function(e,n,i){t.events.trigger("imageManager.imagesLoaded",[e]),c(e,i.response),_.hide()}).fail(function(){var e=this.xhr();y(O,e.response||e.responseText)}):y(U)}function c(e,t){try{A.find(".fr-list-column").empty(),z=0,R=0,j=0,L=e,d()}catch(n){y(B,t)}}function d(){if(R<L.length&&(A.outerHeight()<=F.outerHeight()+t.opts.imageManagerScrollOffset||F.scrollTop()+t.opts.imageManagerScrollOffset>A.outerHeight()-F.outerHeight())){z++;for(var e=t.opts.imageManagerPageSize*(z-1);e<Math.min(L.length,t.opts.imageManagerPageSize*z);e++)u(L[e])}}function u(n){var i=new Image,a=e('<div class="fr-image-container fr-empty fr-image-'+j++ +'" data-loading="'+t.language.translate("Loading")+'.." data-deleting="'+t.language.translate("Deleting")+'..">');h(!1),i.onload=function(){a.height(Math.floor(a.width()/i.width*i.height));var o=e("<img/>");if(n.thumb)o.attr("src",n.thumb);else{if(y(P,n),!n.url)return y(H,n),!1;o.attr("src",n.url)}if(n.url&&o.attr("data-url",n.url),n.tag)if(D.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),D.find(".fr-modal-tags").show(),n.tag.indexOf(",")>=0){for(var r=n.tag.split(","),s=0;s<r.length;s++)r[s]=r[s].trim(),0===x.find('a[title="'+r[s]+'"]').length&&x.append('<a role="button" title="'+r[s]+'">'+r[s]+"</a>");o.attr("data-tag",r.join())}else 0===x.find('a[title="'+n.tag.trim()+'"]').length&&x.append('<a role="button" title="'+n.tag.trim()+'">'+n.tag.trim()+"</a>"),o.attr("data-tag",n.tag.trim());for(var l in n)"thumb"!=l&&"url"!=l&&"tag"!=l&&o.attr("data-"+l,n[l]);a.append(o).append('<i class="fa fa-trash-o fr-delete-img" title="'+t.language.translate("Delete")+'"></i>').append('<i class="fa fa-plus fr-insert-img" title="'+t.language.translate("Insert")+'"></i>'),x.find(".fr-selected-tag").each(function(e,t){S(o,t.text)||a.hide()}),o.on("load",function(){a.removeClass("fr-empty"),a.height("auto"),R++;var e=p(parseInt(o.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);g(e),h(!1),R%t.opts.imageManagerPageSize===0&&d()}),t.events.trigger("imageManager.imageLoaded",[o])},i.onerror=function(){R++,a.remove();var e=p(parseInt(a.attr("class").match(/fr-image-(\d+)/)[1],10)+1);g(e),y(M,n),R%t.opts.imageManagerPageSize===0&&d()},i.src=n.url,f().append(a)}function f(){var t,n;return A.find(".fr-list-column").each(function(i,a){var o=e(a);0===i?(n=o.outerHeight(),t=o):o.outerHeight()<n&&(n=o.outerHeight(),t=o)}),t}function p(t){void 0===t&&(t=0);for(var n=[],i=j-1;i>=t;i--){var a=A.find(".fr-image-"+i);a.length&&(n.push(a),e('<div id="fr-image-hidden-container">').append(a),A.find(".fr-image-"+i).remove())}return n}function g(e){for(var t=e.length-1;t>=0;t--)f().append(e[t])}function h(e){if(void 0===e&&(e=!0),!T.is(":visible"))return!0;var n=a();if(n!=N){N=n;var i=p();o(),g(i)}var r=t.$window.height(),s=T.find(".fr-modal-wrapper"),l=parseFloat(s.css("margin-top"))+parseFloat(s.css("margin-bottom")),c=parseFloat(s.css("padding-top"))+parseFloat(s.css("padding-bottom")),u=parseFloat(s.css("border-top-width")),f=s.find("h4").outerHeight();F.height(Math.min(A.outerHeight(),r-l-c-f-u)),e&&d()}function m(n){var a=e(n.currentTarget).siblings("img");if(i(),t.image.showProgressBar(),V)V.trigger("click");else{t.events.focus(!0),t.selection.restore();var o=t.position.getBoundingRect(),r=o.left+o.width/2,s=o.top+o.height;t.popups.setContainer("image.insert",t.$box||e("body")),t.popups.show("image.insert",r,s)}var l={},c=a.data();for(var d in c)"url"!=d&&"tag"!=d&&(l[d]=c[d]);t.image.insert(a.data("url"),!1,l,V)}function v(n){var i=e(n.currentTarget).siblings("img"),a=t.language.translate("Are you sure? Image will be deleted.");confirm(a)&&(t.opts.imageManagerDeleteURL?t.events.trigger("imageManager.beforeDeleteImage",[i])!==!1&&(i.parent().addClass("fr-image-deleting"),e.ajax({method:t.opts.imageManagerDeleteMethod,url:t.opts.imageManagerDeleteURL,data:e.extend({src:i.attr("src")},t.opts.imageManagerDeleteParams)}).done(function(e){t.events.trigger("imageManager.imageDeleted",[e]);var n=p(parseInt(i.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);i.parent().remove(),g(n),h(!0)}).fail(function(){var e=this.xhr();y($,e.response||e.responseText)})):y(K))}function y(n,i){n>=10&&20>n?_.hide():n>=20&&30>n&&e(".fr-image-deleting").removeClass("fr-image-deleting"),t.events.trigger("imageManager.error",[{code:n,message:W[n]},i])}function w(){var e=D.find(".fr-modal-title-line").outerHeight(),t=x.outerHeight();D.toggleClass(".fr-show-tags"),D.hasClass(".fr-show-tags")?(D.css("height",e+t),x.find("a").css("opacity",1)):(D.css("height",e),x.find("a").css("opacity",0))}function b(){var t=x.find(".fr-selected-tag");t.length>0?(A.find("img").parent().show(),t.each(function(t,n){A.find("img").each(function(t,i){var a=e(i);S(a,n.text)||a.parent().hide()})})):A.find("img").parent().show();var n=p();g(n),d()}function k(n){n.preventDefault();var i=e(n.currentTarget);i.toggleClass("fr-selected-tag"),t.opts.imageManagerToggleTags&&i.siblings("a").removeClass("fr-selected-tag"),b()}function S(e,t){for(var n=e.attr("data-tag").split(","),i=0;i<n.length;i++)if(n[i]==t)return!0;return!1}function C(){_=T.find("#fr-preloader-"+t.id),A=T.find("#fr-image-list-"+t.id),F=T.find("#fr-scroller-"+t.id),x=T.find("#fr-modal-tags-"+t.id),D=x.parent(),N=a(),o();var n=D.find(".fr-modal-title-line").outerHeight();D.css("height",n),F.css("margin-top",n),t.events.bindClick(T,"i#fr-modal-close-"+t.id,i),e(window).on("resize.imagemanager"+t.id,h),t.helpers.isMobile()&&(t.events.bindClick(A,"div.fr-image-container",function(t){T.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),e(t.currentTarget).addClass("fr-mobile-selected")}),T.on(t._mousedown,function(){T.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),t.events.bindClick(A,".fr-insert-img",m),t.events.bindClick(A,".fr-delete-img",v),T.on(t._mousedown+" "+t._mouseup,function(e){e.stopPropagation()}),T.on(t._mousedown,"*",function(){t.events.disableBlur()}),F.on("scroll",d),t.events.bindClick(T,"i#fr-modal-more-"+t.id,w),t.events.bindClick(x,"a",k),t.events.on("destroy",function(){e(window).off("resize.imagemanager"+t.id)},!0)}function E(){return t.$wp||"IMG"==t.$el.get(0).tagName?void s():!1}var T,_,A,F,x,D,I,L,z,R,j,N,M=10,O=11,U=12,B=13,P=14,H=15,$=21,K=22,W={};W[M]="Image cannot be loaded from the passed link.",W[O]="Error during load images request.",W[U]="Missing imageManagerLoadURL option.",W[B]="Parsing load response failed.",W[P]="Missing image thumb.",W[H]="Missing image URL.",W[$]="Error during delete image request.",W[K]="Missing imageManagerDeleteURL option.";var V;return{require:["image"],_init:E,show:n,hide:i}},!e.FroalaEditor.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");e.FroalaEditor.DEFAULTS.imageInsertButtons.push("imageManager"),e.FroalaEditor.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.imageManager.show()}}),e.FroalaEditor.DefineIcon("imageManager",{NAME:"fa fa-folder"})});